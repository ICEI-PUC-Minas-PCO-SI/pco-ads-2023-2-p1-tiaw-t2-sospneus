<!DOCTYPE html>
<html lang="pt-br">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link
      rel="stylesheet"
      href="https://maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css"
    />
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />

    <script
      src="https://kit.fontawesome.com/dad3ff2ba1.js"
      crossorigin="anonymous"
    ></script>

    <script
      async
      src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCQRoUAz_p1A304EFpZblVlq315hoEt89Q&callback=initMap"
    ></script>

    <title>S.O.S. Pneus</title>
    <style>
      body {
        font-family: Arial, sans-serif;
      }

      .header {
        background-color: #343a40;
        color: #ffffff;
        padding: 1rem;
        text-align: center;
      }

      .logo {
        width: 100px;
        height: 100px;
        border-radius: 50%;
      }

      .form-select {
        margin: 20px 0;
      }

      .results {
        margin-top: 20px;
      }

      .square {
        width: 1100px;
        height: 200px;
        background-color: #fcfcfc;
        border: 2px solid #ccc;
        border-radius: 10px;
        display: flex;
        align-items: center;
        justify-content: center;
      }

      #map {
        height: 400px;
        width: 100%;
        margin-top: 20px;
      }
    </style>
  </head>

  <body>
    <header class="header">
      <img src="img SOS.jpg" class="logo" alt="Logo" />
      <h1>Home Cliente</h1>
      <button class="btn btn-primary m-3">Histórico</button>
      <a href="Login.html" class="btn btn-primary m-3">
        <i class="fa-solid fa-arrow-right-from-bracket fa-bounce"></i> Log Out
      </a>
    </header>

    <main class="container">
      <div class="text-center mb-4">
        <div class="square mx-auto m-3 d-flex flex-column align-items-center">
          <h2>VEÍCULO ATUAL</h2>
          <div class="botao m-3" style="width: 95%">
            <select class="form-select" aria-label="Selecione seu Veículo">
              <option selected disabled>Selecione seu Veículo</option>
              <option value="carro">Carro</option>
              <option value="moto">Moto</option>
              <option value="caminhao">Vans Utilitárias e Caminhões</option>
            </select>
          </div>
        </div>
      </div>

      <div class="text-center mb-4">
        <div class="square mx-auto d-flex flex-column align-items-center">
          <h2>BORRACHARIA</h2>
          <div class="form-group">
            <button
              type="submit"
              class="btn btn-primary"
              onclick="iniciarBusca()"
            >
              Iniciar Busca
            </button>
          </div>
        </div>
      </div>

      <div class="text-center">
        <div id="map"></div>
      </div>
    </main>

    <footer class="bg-dark text-light text-center py-3">
      <p>&copy; 2023 S.O.S. Pneus. Todos os direitos reservados.</p>
    </footer>

    <script>
      let map;
      const markers = [];

      function iniciarBusca() {
        if (navigator.geolocation) {
          navigator.geolocation.getCurrentPosition(function (position) {
            const userLocation = {
              lat: position.coords.latitude,
              lng: position.coords.longitude,
            };

            map = new google.maps.Map(document.getElementById("map"), {
              center: userLocation,
              zoom: 15,
            });

            new google.maps.Marker({
              position: userLocation,
              map: map,
              title: "Sua Localização Atual",
            });

            const service = new google.maps.places.PlacesService(map);
            service.nearbySearch(
              {
                location: userLocation,
                radius: 20000,
                type: "car_repair",
              },
              function (results, status) {
                if (status === google.maps.places.PlacesServiceStatus.OK) {
                  markers.forEach((marker) => marker.setMap(null));

                  results.forEach((place) => {
                    const marker = new google.maps.Marker({
                      position: place.geometry.location,
                      map: map,
                      title: place.name,
                    });

                    const infowindow = new google.maps.InfoWindow({
                      content: place.name,
                    });

                    marker.addListener("click", function () {
                      infowindow.open(map, marker);
                    });

                    markers.push(marker);
                  });
                } else {
                  console.error("Erro na busca de lugares:", status);
                }
              }
            );
          });
        } else {
          alert("Geolocalização não é suportada pelo seu navegador.");
        }
      }
    </script>
  </body>
</html>
